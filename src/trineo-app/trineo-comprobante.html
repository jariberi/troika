<dom-module id="trineo-comprobante">
    <template>
        <style include="shared-styles iron-flex iron-flex-alignment">
            :host {
                display: block;
            }
            paper-card {
                margin: 30px 40px;
                width: 100%;
            }
            object {
                margin-top: 30px;
                width: 100%;
                height: 64vh;
            }
        </style>

        <app-route route="{{route}}" pattern="/:comprobante_id" data="{{routeData}}" ></app-route>

        <iron-ajax
             id="getcompajax"
             headers="[[getAuthHeader(userBackend.auth_token)]]"
             url="[[apiUrl]]/ventas/[[routeData.comprobante_id]]/"
             handle-as="json"
             last-response="{{comprobante}}"></iron-ajax>
        

        <div class="page-content">
            <paper-card heading="[[comp]] [[pad_with_zeroes(comprobante.punto_venta,4)]] - [[pad_with_zeroes(comprobante.numero,8)]]">
            <div class="card-content">
                <div class="layout vertical">
                    <div class="layout horizontal justified">
                        <span>Tipo: [[comp]]</span>
                        <span>Número: [[pad_with_zeroes(comprobante.punto_venta,4)]] - [[pad_with_zeroes(comprobante.numero,8)]]</span>
                        <span>CAE: [[comprobante.cae]]</span>
                        <span>Vecimiento CAE: [[vencimientoCAE]]</span>
                    </div>
                </div>
                <object data="[[apiUrl]]/utils/comprobante_en_pdf/[[routeData.comprobante_id]]/" type="application/pdf">
                    </object>
            </div>
        </paper-card>
        </div>
        
        
    </template>
    <script>
        Polymer({
            is: 'trineo-comprobante',

            behaviors: [UtilsBehavior, AjaxBehavior],

            properties: {
                route: Object,
                routeData: Object,
                comprobante: Object,
                userBackend: Object,
                comp: {
                    type: String,
                    computed: "_compCompute(comprobante.tipo)"
                },
                vencimientoCAE: {
                    type:String,
                    computed: "_vencimientoCAECompute(comprobante.fvto_cae)"
                }
            },

            observers: [
                "_compChanged(routeData.comprobante_id)"
            ],

            _compChanged: function (id) {
                if (id != undefined && id != null) {
                    this.$.getcompajax.auto=true
                }
            },

            _compCompute: function(tipo) {
                if(tipo.startsWith("FA")) {
                    return "Factura "+tipo[tipo.length-1]
                }
                else if (tipo.startsWith("ND")) {
                    return "Nota de débito "+tipo[tipo.length-1]
                }
                return "Nota de crédito "+tipo[tipo.length-1]
            },

            _vencimientoCAECompute: function(fvto) {
                return moment(fvto).format('DD/MM/YYYY')
            }
        });
    </script>
</dom-module>
