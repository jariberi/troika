<link rel="import" href="../../../bower_components/iron-localstorage/iron-localstorage.html">
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../behaviors/ajax-behavior.html">

<dom-module id="appline-auth-panel">
    <template>
        <style>
            :host {
                display: none;
            }
        </style>
        <iron-localstorage id="lsuser" name="trineolambda" value="{{userBackend}}"></iron-localstorage>

        <iron-ajax
            id="updateUserAjax"
             headers=[[getAuthHeader(userBackend.auth_token)]]
             url="[[userBackend.url]]"
             handle-as="json"
             last-response="{{userBackend}}"
             on-response="_onResponse"></iron-ajax>
        
    </template>
    <script>
            Polymer({
                is: 'appline-auth-panel',
                
                ready: function() {
                    this.$.lsuser.reload();
                    this.$.updateUserAjax.generateRequest()
                },

                behaviors: [AjaxBehavior],

                properties: {
                    /**
                    * Inform if the user is logged in 
                    *
                    * @type {Boolean}
                    */
                    loggedIn: {
                        type: Boolean,
                        notify: true,
                        computed: "_loggedInCompute(userBackend)"
                    },
                    /**
                    * userBackend
                    *
                    * @type {Object}
                    */
                    userBackend: {
                        type: Object,
                        notify: true,
                    }
                },

                _loggedInCompute: function(user) {
                    return !!user
                },
                //Cada dos horas actualizo la info del usuario, por las dudas que haya cambios en el backend: siguientes dos metodos
                _updateUserData: function() {
                    this.async(function() {
                        this.$.updateUserAjax.generateRequest();
                    }, 7200000);
                },
                _onResponse: function() {
                    this._updateUserData();
                }
            });
    </script>
</dom-module>