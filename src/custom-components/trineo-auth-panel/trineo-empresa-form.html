
<dom-module id="trineo-empresa-form">
    <template>
        <style include="shared-styles iron-flex iron-flex-alignment iron-flex-factors">
            :host {
                display: block;
                width: 30vw;
            }

            paper-input, appline-idfiscal-input, paper-dropdown-menu {
                width: 100%;
                max-width: 300px;
            }

            
        </style>
        
        <iron-ajax
            id="saveEmpresaAjax"
            handle-as="json"
            on-response="handleResponse"
            headers="[[getAuthorizationHeader()]]"
            content-type="application/json"></iron-ajax>
        
        <div class="trineo-dialogs">
            <h2>Nueva empresa: [[razon_social]]</h2>
                    <div class="layout vertical">
                        <appline-idfiscal-input required only-cuit id="cuit" label="Cuit" value="{{cuit}}" error-message="Ingrese CUIT válido"></appline-idfiscal-input>
                        <paper-input id="razonSocial" required label="Razon Social" value="{{razonSocial}}" error-message="Ingrese razón social"></paper-input>
                        <paper-dropdown-menu id="categoriaIva" value="value" required label="Categoria IVA" error-message="Seleccione una categoria de IVA">
                            <paper-listbox class="dropdown-content" selected="{{categoriaIva}}" attr-for-selected="value">
                                <paper-item value="0">Responsable Inscripto</paper-item>
                                <paper-item value="1">Monotributo</paper-item>
                            </paper-listbox>
                        </paper-dropdown-menu>
                    </div>
            <div class="buttons">
                <paper-button raised autofocus on-tap="_close">Cancelar</paper-button>
                <paper-button raised on-tap="_saveEmpresa">Aceptar</paper-button>
            </div>
        </div>
        
    </template>
    <script>
        Polymer({
            is: 'trineo-empresa-form',

            behaviors: [AjaxBehavior, Polymer.IronOverlayBehavior, Polymer.IronValidatableBehavior],

            properties: {
                razonSocial: String,
                cuit: String,
                categoriaIva: String
            },

            ready: function() {
                this.withBackdrop=true
                this.noCancelOnEscKey = true
                this.noCancelOnOutsideClick = true
                this.alwaysOnTop = true
            },

            _getValidity: function() {
                var valid = true
                valid &= this.$.razonSocial.validate();
                valid &= this.$.cuit.validate();
                valid &= this.$.categoriaIva.validate();
                return valid
            },

            _saveEmpresa: function() {
                if(this.validate()){
                    this.$.saveEmpresaAjax.url = this.apiUrl+"/perfiles-user/"
                    this.$.saveEmpresaAjax.method = "POST"
                    obj = {razon_social:this.razonSocial, cuit:this.cuit, categoria_iva: this.categoriaIva}
                    this.$.saveEmpresaAjax.body = JSON.stringify(obj)
                    this.$.saveEmpresaAjax.generateRequest();
                }
            },

            handleResponse: function(e) {
                if(e.detail.xhr.status==200 || e.detail.xhr.status==201) {
                    //this.parent.$.proveedoresList.refreshItems();
                    this.fire("trineo-empresa-form-added", {perfil:e.detail});
                    this._close()
                }
            },

            _close: function() {
                this.close()
                Polymer.dom(Polymer.dom(this).parentNode).removeChild(this);
            }

        });
    </script>
</dom-module>
